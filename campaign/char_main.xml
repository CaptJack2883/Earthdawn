<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<windowclass name="charsheet_main">
		<margins control="5,5,5,5" />
    <script file="campaign/scripts/char_main.lua" />
		<sheetdata>
      
      <anchor_column name="MainFrame">
				<bounds>20,20,400,400</bounds>
      </anchor_column>
      <anchor_column name="columnanchor">
				<anchored to="MainFrame" position="insidetopright" />
      </anchor_column>
			<char_attr_column name="columnattr" />
            
			<frame_char name="charDetail">
				<bounds>1,2,-29,45</bounds>
			</frame_char>
			<string_labeled name="race">
				<anchored to="charDetail" position="insidetopleft" offset="15,10" width="90" height="20" />
				<labelres>char_label_race</labelres>
				<acceptdrop>
          <class>races</class>
				</acceptdrop>
        <droptypes>
					<type merge="add">string</type>
					<type merge="add">shortcut</type>
        </droptypes>
        <script>
          function onDrop(x, y, draginfo)
            if draginfo.isType("shortcut") then
              local sClass, sRecord = draginfo.getShortcutData();
              if StringManager.contains({"races"}, sClass) then
								setValue(DB.getValue(DB.getPath(sRecord, "name")));
                return true;
              end
            end
          end
        </script>
			</string_labeled>
			<string_labeled name="discipline">
				<anchored to="charDetail" position="insidetopleft" offset="120,10" width="90" height="20" />
				<labelres>char_label_discipline</labelres>
				<acceptdrop>
          <class>disciplines</class>
				</acceptdrop>
        <droptypes>
					<type merge="add">string</type>
					<type merge="add">shortcut</type>
        </droptypes>
        <script>
          function onDrop(x, y, draginfo)
            if draginfo.isType("shortcut") then
              local sClass, sRecord = draginfo.getShortcutData();
              if StringManager.contains({"disciplines"}, sClass) then
								setValue(DB.getValue(DB.getPath(sRecord, "name")));
                return true;
              end
            end
          end
        </script>
			</string_labeled>
			<string_labeled name="circle">
				<anchored to="charDetail" position="insidetopleft" offset="225,10" width="70" height="20" />
				<labelres>char_label_circle</labelres>
			</string_labeled>
			<string_labeled name="legendTotal">
				<anchored to="charDetail" position="insidetopleft" offset="310,10" width="70" height="20" />
				<labelres>char_label_legendtotal</labelres>
			</string_labeled>
			<string_labeled name="legendCurrent">
				<anchored to="charDetail" position="insidetopleft" offset="395,10" width="70" height="20" />
				<labelres>char_label_legendcurrent</labelres>
			</string_labeled>
      
      <frame_char name="AttrFrame">
				<bounds>1,45,230,240</bounds>
      </frame_char>
      <label_frametop name="AttrLabel">
				<anchored to="AttrFrame" />
        <static textres="char_label_attributes" />
      </label_frametop>
      <label_column name="ValueLabel">
				<anchored>
          <top offset="60" />
          <left offset="90" />
				</anchored>
        <static textres="char_label_value" />
      </label_column>
      <label_column name="BonusLabel">
				<anchored>
          <top offset="60" />
          <left offset="130" />
				</anchored>
        <static textres="char_label_bonus" />
      </label_column>
      <label_column name="StepLabel">
				<anchored>
          <top offset="60" />
          <left offset="180" />
				</anchored>
        <static textres="char_label_step" />
      </label_column>
      
      <label_column name="dexterity">
				<anchored>
          <top offset="80" />
          <left offset="15" />
				</anchored>
        <static textres="char_attr_dex" />
      </label_column>
      <number_column name="Dex_Value" source="abilities.dexterity.value">
				<anchored width="30">
          <top offset="80" />
          <left offset="90" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Dexterity Value" />
        <default>10</default>
      </number_column>
      <number_column name="Dex_Bonus" source="abilities.dexterity.bonus">
				<anchored width="30">
          <top offset="-20" />
          <left offset="135" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Dexterity Bonus" />
        <default>0</default>
      </number_column>
      <number_column name="Dex_Step" source="abilities.dexterity.step">
				<anchored width="30">
          <top offset="-20" />
          <left offset="180" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "dexterity", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "dexterity";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_column>
      
      <label_column name="strength">
				<anchored>
          <top offset="10" />
          <left offset="15" />
				</anchored>
        <static textres="char_attr_str" />
      </label_column>      
      <number_column name="Str_Value" source="abilities.strength.value">
				<anchored width="30">
          <top offset="10" />
          <left offset="90" />
				</anchored>
        <description text="Strength Value" />
        <default>10</default>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
      </number_column>
      <number_column name="Str_Bonus" source="abilities.strength.bonus">
				<anchored width="30">
          <top offset="-20" />
          <left offset="135" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Strength Bonus" />
        <default>0</default>
      </number_column>
      <number_column name="Str_Step" source="abilities.strength.step">
				<anchored width="30">
          <top offset="-20" />
          <left offset="180" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "strength", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "strength";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <default>5</default>
        <rollable />
      </number_column>
      
      <label_column name="toughness">
				<anchored>
          <top offset="10" />
          <left offset="15" />
				</anchored>
        <static textres="char_attr_tou" />
      </label_column>
      <number_column name="Tou_Value" source="abilities.toughness.value">
				<anchored width="30">
          <top offset="10" />
          <left offset="90" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Toughness Value" />
        <default>10</default>
      </number_column>
      <number_column name="Tou_Bonus" source="abilities.toughness.bonus">
				<anchored width="30">
          <top offset="-20" />
          <left offset="135" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Toughness Bonus" />
        <default>0</default>
      </number_column>
      <number_column name="Tou_Step" source="abilities.toughness.step">
				<anchored width="30">
          <top offset="-20" />
          <left offset="180" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "toughness", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "toughness";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_column>

      <label_column name="perception">
				<anchored>
          <top offset="10" />
          <left offset="15" />
				</anchored>
        <static textres="char_attr_per" />
      </label_column>
      <number_column name="Per_Value" source="abilities.perception.value">
				<anchored width="30">
          <top offset="10" />
          <left offset="90" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Perception Value" />
        <default>10</default>
      </number_column>
      <number_column name="Per_Bonus" source="abilities.perception.bonus">
				<anchored width="30">
          <top offset="-20" />
          <left offset="135" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Perception Bonus" />
        <default>0</default>
      </number_column>
      <number_column name="Per_Step" source="abilities.perception.step">
				<anchored width="30">
          <top offset="-20" />
          <left offset="180" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "perception", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "perception";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_column>

      <label_column name="willpower">
				<anchored>
          <top offset="10" />
          <left offset="15" />
				</anchored>
        <static textres="char_attr_wil" />
      </label_column>
      <number_column name="Wil_Value" source="abilities.willpower.value">
				<anchored width="30">
          <top offset="10" />
          <left offset="90" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Willpower Value" />
        <default>10</default>
      </number_column>
      <number_column name="Wil_Bonus" source="abilities.willpower.bonus">
				<anchored width="30">
          <top offset="-20" />
          <left offset="135" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Willpower Bonus" />
        <default>0</default>
      </number_column>
      <number_column name="Wil_Step" source="abilities.willpower.step">
				<anchored width="30">
          <top offset="-20" />
          <left offset="180" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "willpower", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "willpower";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_column>

      <label_column name="charisma">
				<anchored>
          <top offset="10" />
          <left offset="15" />
				</anchored>
        <static textres="char_attr_cha" />
      </label_column>
      <number_column name="Cha_Value" source="abilities.charisma.value">
				<anchored width="30">
          <top offset="10" />
          <left offset="90" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Charisma Value" />
        <default>10</default>
      </number_column>
      <number_column name="Cha_Bonus" source="abilities.charisma.bonus">
				<anchored width="30">
          <top offset="-20" />
          <left offset="135" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Charisma Bonus" />
        <default>0</default>
      </number_column>
      <number_column name="Cha_Step" source="abilities.charisma.step">
				<anchored width="30">
          <top offset="-20" />
          <left offset="180" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "charisma", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "charisma";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_column>

      <frame_char name="CurrentHealthFrame">
				<bounds>225,45,125,160</bounds>
      </frame_char>
      <label_frametop name="CurrentLabel">
				<anchored to="CurrentHealthFrame">
				</anchored>
        <static textres="char_label_currentDmg" />
      </label_frametop>
      <label name="TotalDamageLabel">
				<anchored to="CurrentHealthFrame">
          <top offset="25" />
          <left offset="50" />
				</anchored>
        <static textres="char_label_total" />
      </label>
      <label name="CurrentDamageLabel">
				<anchored to="CurrentHealthFrame">
          <top offset="65" />
          <left offset="15" />
				</anchored>
        <static textres="char_label_damage" />
      </label>
      <label name="CurrentWoundsLabel">
				<anchored to="CurrentHealthFrame">
          <top offset="65" />
          <left offset="65" />
				</anchored>
        <static textres="char_label_wounds" />
      </label>
      <number_ED4 name="Total_Damage" source="health.damage.total">
        <anchored to="CurrentHealthFrame" width="60" height="20">
          <top offset="75" />
          <left offset="30" />
				</anchored>
        <min>0</min>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <readonly />
        <delaykeyupdate />
        <default>0</default>
      </number_ED4>
      <number_ED4 name="Current_Damage" source="health.damage.value">
        <anchored to="CurrentHealthFrame" width="35" height="20">
          <top offset="115" />
          <left offset="20" />
				</anchored>
        <min>0</min>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDrop(x, y, draginfo)
            if draginfo.isType("recovery") then
              setValue(getValue() - draginfo.getNumberData());
              return true;
            elseif draginfo.isType("heal") then
              setValue(getValue() - draginfo.getNumberData());
              return true;
            elseif draginfo.isType("damage") then
              setValue(getValue() + draginfo.getNumberData());
              return true;
            end
          end
        </script>
        <delaykeyupdate />
        <default>0</default>
      </number_ED4>
      <number_ED4 name="Current_Wounds" source="health.wounds.value">
        <anchored to="CurrentHealthFrame" width="35" height="20">
          <top offset="115" />
          <left offset="70" />
				</anchored>
        <min>0</min>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDrop(x, y, draginfo)
            if draginfo.isType("Wound") then
              setValue(getValue() + draginfo.getNumberData());
              return true;
            elseif draginfo.isType("WoundHeal") then
              setValue(getValue() - draginfo.getNumberData());
              return true;
            end
          end
        </script>
        <default>0</default>
      </number_ED4>
      
      <label name="StunDamageLabel">
				<anchored to="CurrentHealthFrame">
          <top offset="105" />
          <left offset="23" />
				</anchored>
        <static textres="char_label_stun" />
      </label>
      <label name="BloodDamageLabel">
				<anchored to="CurrentHealthFrame">
          <top offset="105" />
          <left offset="70" />
				</anchored>
        <static textres="char_label_blood" />
      </label>
      <number_ED4 name="Stun_Damage" source="health.damage.stun">
        <anchored to="CurrentHealthFrame" width="35" height="20">
          <top offset="155" />
          <left offset="20" />
				</anchored>
        <min>0</min>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
          function onDrop(x, y, draginfo)
            if draginfo.isType("recovery") then
              setValue(getValue() - draginfo.getNumberData());
              return true;
            elseif draginfo.isType("heal") then
              setValue(getValue() - draginfo.getNumberData());
              return true;
            elseif draginfo.isType("damage") then
              setValue(getValue() + draginfo.getNumberData());
              return true;
            end
          end
        </script>
        <delaykeyupdate />
        <default>0</default>
      </number_ED4>
      <number_ED4 name="Blood_Damage" source="health.damage.blood">
        <anchored to="CurrentHealthFrame" width="35" height="20">
          <top offset="155" />
          <left offset="70" />
				</anchored>
        <min>0</min>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <delaykeyupdate />
        <default>0</default>
      </number_ED4>
      
      <frame_char name="DefFrame">
				<bounds>345,45,160,80</bounds>
      </frame_char>
      <label_frametop name="DefLabel">
				<anchored to="DefFrame">
				</anchored>
        <static textres="char_label_defenses" />
      </label_frametop>
      <label name="PhysicalDefLabel">
				<anchored to="DefFrame">
          <top offset="25" />
          <left offset="12" />
				</anchored>
        <static textres="char_label_physical" />
      </label>
      <label name="MysticDefLabel">
				<anchored to="DefFrame">
          <top offset="25" />
          <left offset="62" />
				</anchored>
        <static textres="char_label_mystic" />
      </label>
      <label name="SocialDefLabel">
				<anchored to="DefFrame">
          <top offset="25" />
          <left offset="105" />
				</anchored>
        <static textres="char_label_social" />
      </label>
      <number_ED4 name="Physical_Def" source="defenses.physical.value">
        <anchored to="DefFrame" width="35" height="20">
          <top offset="75" />
          <left offset="15" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Physical Defense" />
        <default>5</default>
      </number_ED4>
      <number_ED4 name="Mystic_Def" source="defenses.mystic.value">
        <anchored to="DefFrame" width="35" height="20">
          <top offset="75" />
          <left offset="60" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Mystic Defense" />
        <default>5</default>
      </number_ED4>
      <number_ED4 name="Social_Def" source="defenses.social.value">
        <anchored to="DefFrame" width="35" height="20">
          <top offset="75" />
          <left offset="105" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Social Defense" />
        <default>5</default>
      </number_ED4>
      
      <frame_char name="ArmorFrame">
				<bounds>345,122,160,83</bounds>
      </frame_char>
      <label_frametop name="ArmorLabel">
				<anchored to="ArmorFrame">
          <left offset="-45" />
				</anchored>
        <static textres="char_label_armor" />
      </label_frametop>
      <label_frametop name="WoundLabel">
				<anchored to="ArmorFrame">
          <left offset="85" />
				</anchored>
        <static textres="char_label_wounds" />
      </label_frametop>
      <label name="PhysicalArmorLabel">
				<anchored to="ArmorFrame">
          <top offset="25" />
          <left offset="10" />
				</anchored>
        <static textres="char_label_physical" />
      </label>
      <label name="MysticArmorLabel">
				<anchored to="ArmorFrame">
          <top offset="25" />
          <left offset="60" />
				</anchored>
        <static textres="char_label_mystic" />
      </label>
      <label name="ThresholdLabel">
				<anchored to="ArmorFrame">
          <top offset="25" />
          <left offset="105" />
				</anchored>
        <static textres="char_label_threshold" />
      </label>
      <number_ED4 name="Physical_Armor" source="armor.physical.value">
        <anchored to="ArmorFrame" width="35" height="20">
          <top offset="155" />
          <left offset="15" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Physical Armor" />
        <default>0</default>
      </number_ED4>
      <number_ED4 name="Mystic_Armor" source="armor.mystic.value">
        <anchored to="ArmorFrame" width="35" height="20">
          <top offset="155" />
          <left offset="62" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <description text="Mystic Armor" />
        <default>0</default>
      </number_ED4>
      <number_ED4 name="Wound_Threshold" source="health.wound.threshold">
        <anchored to="ArmorFrame" width="35" height="20">
          <top offset="155" />
          <left offset="110" />
				</anchored>
        <description text="Wound Threshold" />
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <default>5</default>
      </number_ED4>
      
      <frame_char name="HealthFrame">
				<bounds>225,200,125,85</bounds>
      </frame_char>
      <label_frametop name="HealthLabel">
				<anchored to="HealthFrame">
				</anchored>
        <static textres="char_label_health" />
      </label_frametop>
      <label name="UnconciousLabel">
				<anchored to="HealthFrame">
          <top offset="25" />
          <left offset="15" />
				</anchored>
        <static textres="char_label_uncon" />
      </label>
      <label name="DeathLabel">
				<anchored to="HealthFrame">
          <top offset="25" />
          <left offset="70" />
				</anchored>
        <static textres="char_label_death" />
      </label>
      <number_ED4 name="Uncon_Rating" source="health.uncon.value">
        <anchored to="HealthFrame" width="35" height="20">
          <top offset="230" />
          <left offset="15" />
				</anchored>
        <description text="Unconciousness Rating" />
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <default>0</default>
      </number_ED4>
      <number_ED4 name="Death_Rating" source="health.death.value">
        <anchored to="HealthFrame" width="35" height="20">
          <top offset="230" />
          <left offset="70" />
				</anchored>
        <description text="Death Rating" />
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <default>0</default>
      </number_ED4>
      
      <frame_char name="InitFrame">
				<bounds>345,200,160,85</bounds>
      </frame_char>
      <label_frametop name="InitiativeLabel">
				<anchored to="InitFrame">
          <left offset="-70" />
				</anchored>
        <static textres="char_label_initiative" />
      </label_frametop>      
      <label_frametop name="KnockdownLabel">
				<anchored to="InitFrame">
          <left offset="60" />
				</anchored>
        <static textres="char_label_knockdown" />
      </label_frametop>
      <number_ED4 name="Initiative_Step" source="initiative.step">
        <anchored to="InitFrame" width="35" height="20">
          <top offset="225" />
          <left offset="25" />
				</anchored>
        <script>
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "initroll", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "initroll";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <default>5</default>
        <rollable />
      </number_ED4>
      <number_ED4 name="Knockdown_Step" source="defenses.knockdown.step">
        <anchored to="InitFrame" width="35" height="20">
          <top offset="225" />
          <left offset="90" />
				</anchored>
        <script>
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "knockdown", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "knockdown";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_ED4>
      
      <frame_char name="KarmaFrame">
				<bounds>345,280,160,75</bounds>
      </frame_char>
      <label_frametop name="KarmaLabel">
				<anchored to="KarmaFrame">
          <left offset="-100" />
				</anchored>
        <static textres="char_label_karma" />
      </label_frametop>
      <label_frametop name="RecoveryLabel">
				<anchored to="KarmaFrame">
          <left offset="5" />
				</anchored>
        <static textres="char_label_recovery" />
      </label_frametop>
      <label_frametop name="RecoveryTestsLabel">
				<anchored to="KarmaFrame">
          <left offset="100" />
				</anchored>
        <static textres="char_label_tests" />
      </label_frametop>
      <number_ED4 name="KarmaStep" source="karma.step">
        <anchored to="KarmaFrame" position="insidetopleft" width="35" height="20">
				</anchored>
        <script>
          function onInit()
            window.updateKarma();
          end
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <default>4</default>
        <invisible />
      </number_ED4>
      <number_ED4 name="MaxKarma" source="karma.max">
        <anchored to="KarmaFrame" position="insidetopleft" width="35" height="20">
				</anchored>
        <script>
          function onInit()
            window.updateKarma();
          end
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <invisible />
      </number_ED4>
      <number_ED4 name="Karma_Value" source="karma.value">
        <anchored to="KarmaFrame" width="35" height="20">
          <top offset="300" />
          <left offset="15" />
				</anchored>
        <min>0</min>
        <script>
          function onDragStart(button, x, y, draginfo)
            local kValue = getValue();
            if kValue > 0 then
              local karmaStep = 4;
              local rActor = ActorManager.resolveActor(window.getDatabaseNode());
              karmaStep = CharacterManager.getKarmaStep(rActor);
              ActionManagerED4.dragRoll(draginfo, "karma", karmaStep, rActor);
            end
            return true;
          end
          function onDoubleClick()
            local kValue = getValue();
            if kValue > 0 then
              local karmaStep = 4;
              local sType = "karma";
              local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
              karmaStep = CharacterManager.getKarmaStep(nodeChar);
              local bSecretRoll = false;
              ActionManagerED4.pushRoll(sType, karmaStep, nodeChar, bSecretRoll);
            end
          end
        </script>
        <rollable />
      </number_ED4>
      <number_ED4 name="Recovery_Step" source="health.recovery.step">
        <anchored to="KarmaFrame" width="35" height="20">
          <top offset="300" />
          <left offset="64" />
				</anchored>
        <script>
          function onDragStart(button, x, y, draginfo)
            local rActor = ActorManager.resolveActor(window.getDatabaseNode());
            ActionManagerED4.dragRoll(draginfo, "recovery", getValue(), rActor);
            return true;
          end
          function onDoubleClick()
            local sType = "recovery";
            local rStep = getValue();
            local nodeChar = ActorManager.resolveActor(window.getDatabaseNode());
            local bSecretRoll = false;
            ActionManagerED4.pushRoll(sType, rStep, nodeChar, bSecretRoll);
          end
        </script>
        <rollable />
        <default>5</default>
      </number_ED4>
      <number_ED4 name="Recovery_tests" source="health.recovery.tests">
        <anchored to="KarmaFrame" width="30" height="20">
          <top offset="300" />
          <left offset="112" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
      </number_ED4>
      <number_ED4 name="Recovery_max" source="health.recovery.max">
        <anchored to="KarmaFrame" width="30" height="20">
          <top offset="300" />
          <left offset="112" />
				</anchored>
        <script>
          function onValueChanged()
            if not Global.cmUpdating then
              Global.cmUpdating = true;
              window.onUpdate();
              Global.cmUpdating = false;
            end
          end
        </script>
        <readonly />
        <invisible />
      </number_ED4>
      
      <frame_char name="movementFrame">
				<bounds>225,280,125,75</bounds>
      </frame_char>
      <label_frametop name="movementLabel">
				<anchored to="movementFrame" />
        <static textres="char_label_movement" />
      </label_frametop>
			<string_labeled name="movement" source="movement.value">
				<anchored to="movementFrame" position="insidetopleft" offset="20,30" width="85" height="20" />
				<labelres>char_label_movement</labelres>
        <description text="Movement" />
				<acceptdrop>
          <class>movement</class>
          <type>string</type>
				</acceptdrop>
        <droptypes>
					<type merge="add">string</type>
					<type merge="add">shortcut</type>
        </droptypes>
        <script>
          function onDrop(x, y, draginfo)
            if draginfo.isType("shortcut") then
              local sClass, sRecord = draginfo.getShortcutData();
              if StringManager.contains({"movement"}, sClass) then
								setValue(DB.getValue(DB.getPath(sRecord, "name")));
                return true;
              end
            end
          end
          function onDragStart(button, x, y, draginfo)
            local nodeChar = window.getDatabaseNode();
            local nodeSrc = getDatabaseNode();
            local sName = DB.getValue(nodeChar, "name");
            local sDesc = DB.getText(nodeSrc, "description");
            draginfo.setDescription(tostring(sDesc));
          end
        </script>
			</string_labeled>      
            
      <frame_char name="sensesFrame">
				<bounds>1,280,230,75</bounds>
      </frame_char>
      <label_frametop name="sensesLabel">
				<anchored to="sensesFrame" />
        <static textres="char_label_senses" />
      </label_frametop>
			<string_labeled name="senses">
				<anchored to="sensesFrame" position="insidetopleft" offset="20,30" width="190" height="20" />
				<labelres>char_label_senses</labelres>
        <description text="Senses" />
				<acceptdrop>
          <class>senses</class>
          <type>string</type>
				</acceptdrop>
        <droptypes>
					<type merge="add">string</type>
					<type merge="add">shortcut</type>
        </droptypes>
        <script>
          function onDrop(x, y, draginfo)
            if draginfo.isType("shortcut") then
              local sClass, sRecord = draginfo.getShortcutData();
              if StringManager.contains({"senses"}, sClass) then
								setValue(DB.getValue(DB.getPath(sRecord, "name")));
                return true;
              end
            end
          end
          function onDragStart(button, x, y, draginfo)
            local nodeChar = window.getDatabaseNode();
            local nodeSrc = getDatabaseNode();
            local sName = DB.getValue(nodeChar, "name");
            local sDesc = DB.getText(nodeSrc, "description");
            draginfo.setDescription(tostring(sDesc));
          end
        </script>
			</string_labeled>
      
      <button_text name="test">
				<bounds>20,380,150,50</bounds>
        <script>
          function onClickDown()
            Debug.chat("Testing:");
            local rRoll = StepLookup.getRoll(13);
            local rTarget = {};
            local rSource = {};
            local rActor = {};
            local vTargets = {};
            local rThrow = ActionsManager.buildThrow(rActor, vTargets, rRoll, false);
            Comm.throwDice(rThrow);
          end
        </script>
      </button_text>
      <label_frametop name="test">
				<anchored to="test" />
        <static textres="test" />
      </label_frametop>
      
    </sheetdata>
	</windowclass>
    
</root>
